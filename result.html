<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ã…£ì†”í¬TI ê²°ê³¼</title>
    <style>
        @font-face {
            font-family: 'Pretendard';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Regular.woff2') format('woff2');
            font-weight: 400;
            font-display: swap;
        }
        @font-face {
            font-family: 'Pretendard';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/pretendard@1.0/Pretendard-Bold.woff2') format('woff2');
            font-weight: 700;
            font-display: swap;
        }
        @font-face {
            font-family: 'Ownglyph PDH';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2411-3@1.0/Ownglyph_ParkDaHyun.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        :root {
            --bg: #0B3D2E;
            --card: #142B22;
            --accent: #FFD56B;
            --muted: #CFE9D8;
        }
        * { box-sizing: border-box; }
        html, body {
            margin: 0;
            height: 100%;
            background: var(--bg);
            color: #F8F8F8;
            font-family: 'Pretendard', sans-serif;
            overflow-x: hidden;
        }
        body {
            display: block;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) calc(env(safe-area-inset-bottom) + 16px) env(safe-area-inset-left);
            min-height: 100vh;
        }
        .layout {
            width: 100%;
            min-height: 100vh;
            padding: 32px clamp(16px, 4vw, 48px) 48px;
            background: radial-gradient(80% 60% at 50% 0%, rgba(226,172,38,0.12), transparent 55%), var(--bg);
            animation: fadeInUp 0.7s ease;
        }
        .headline {
            max-width: 960px;
            margin: 0 auto 18px;
        }
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 12px;
            background: #1E4C3A;
            color: var(--muted);
            font-size: 14px;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        .title {
            font-family: 'Ownglyph PDH', sans-serif;
            font-size: clamp(34px, 5.8vw, 50px);
            margin: 4px 0 14px;
            color: var(--accent);
            line-height: 1.2;
        }
        .desc {
            font-size: 19px;
            line-height: 1.6;
            color: #E8F5EE;
            margin-bottom: 12px;
        }
        .meta {
            display: flex;
            gap: 8px;
            align-items: center;
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 18px;
        }
        .panel {
            max-width: 960px;
            margin: 10px auto 0;
            background: rgba(20,43,34,0.92);
            border: 1px solid #2E8B6B;
            border-radius: 16px;
            padding: 22px 20px 24px;
            box-shadow: 0 12px 28px -10px rgba(0,0,0,0.45);
        }
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 14px;
        }
        .btn {
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #2E8B6B;
            background: #1E4C3A;
            color: #F2FDF7;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s, background 0.15s;
            flex: 1 1 160px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.25);
        }
        .btn.primary {
            background: linear-gradient(135deg, #E2AC26, #F6D358);
            border: none;
            color: #0B3D2E;
            font-weight: 700;
        }
        .tip {
            margin-top: 12px;
            font-size: 14px;
            color: var(--muted);
            opacity: 0.9;
        }
        .sections {
            max-width: 960px;
            margin: 18px auto 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 14px;
        }
        .section-card {
            background: rgba(20,43,34,0.9);
            border: 1px solid #214f3d;
            border-radius: 14px;
            padding: 16px 16px 18px;
            box-shadow: 0 10px 22px -12px rgba(0,0,0,0.4);
        }
        .section-title {
            font-size: 17px;
            color: var(--accent);
            margin: 0 0 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title::before {
            content: 'âœ¦';
            color: var(--accent);
            font-size: 16px;
        }
        .bullet-list {
            margin: 0;
            padding-left: 16px;
            color: #E8F5EE;
            line-height: 1.6;
            font-size: 15px;
        }
        .pill-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .pill {
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid #2E8B6B;
            color: #CFE9D8;
            background: rgba(46,139,107,0.1);
            font-size: 14px;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(14px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 520px) {
            .layout { padding: 26px 16px 36px; }
            .desc { font-size: 16px; }
            .btn { width: 100%; }
            .panel { padding: 18px 16px 20px; }
        }
        /* ëˆˆ íš¨ê³¼ */
        .snowflake {
            position: fixed;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            pointer-events: none;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="layout">
        <div class="headline">
            <div class="badge">ì†”í¬TI ê²°ê³¼</div>
            <div id="resultTitle" class="title">íƒ€ì…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <div id="resultDesc" class="desc">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>
            <div class="meta">
                <span id="resultTypeKey">TYPE</span>
            </div>
        </div>
        <div class="panel">
            <div class="actions">
                <button class="btn primary" id="retryBtn">ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸°</button>
                <button class="btn" id="copyBtn">ê²°ê³¼ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
                <button class="btn" id="storyBtn">ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ë¡œ ê³µìœ </button>
                <button class="btn" id="downloadBtn">ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥</button>
            </div>
            <div class="tip">ìŠ¤í† ë¦¬ ìë™ ì—…ë¡œë“œëŠ” ë¸Œë¼ìš°ì € ì •ì±…ìƒ ë¶ˆê°€í•©ë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ì €ì¥í•œ ë’¤ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì—ì„œ ë¶ˆëŸ¬ì™€ ì£¼ì„¸ìš”.</div>
        </div>
        <div class="sections">
            <div class="section-card">
                <div class="section-title">ì–´ìš¸ë¦¬ëŠ” í™œë™</div>
                <ul id="actionsList" class="bullet-list"></ul>
            </div>
            <div class="section-card">
                <div class="section-title">ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</div>
                <div id="playlistPills" class="pill-row"></div>
            </div>
            <div class="section-card">
                <div class="section-title">ë‹¹ì‹ ì—ê²Œ í•œë§ˆë””</div>
                <div id="messageText" class="desc" style="margin:0;"></div>
            </div>
        </div>
    </div>

    <script>
    const stored = sessionStorage.getItem('solktiResult');
    const result = stored ? JSON.parse(stored) : null;
    const fallback = {
        typeKey: 'GIVER',
        title: 'ì‚°íƒ€í˜• GIVER',
        desc: 'ì£¼ë³€ì„ ë”°ëœ»í•˜ê²Œ ì±„ì›Œì£¼ëŠ” ì‚°íƒ€ íƒ€ì…! ì„ ë¬¼ê³¼ ë°°ë ¤ë¡œ ëª¨ë‘ë¥¼ ì›ƒê²Œ ë§Œë“­ë‹ˆë‹¤.',
        color: '#E2AC26'
    };
    const data = result || fallback;

    const titleEl = document.getElementById('resultTitle');
    const descEl = document.getElementById('resultDesc');
    const typeEl = document.getElementById('resultTypeKey');

    titleEl.textContent = data.title;
    descEl.textContent = data.desc;
    typeEl.textContent = data.typeKey;
    document.documentElement.style.setProperty('--accent', data.color || '#FFD56B');

    // ë³´ì¡° ì½˜í…ì¸ 
    const extras = {
        GIVER: {
            actions: ['ì§ì ‘ í¬ì¥í•œ ì„ ë¬¼ ë‚˜ëˆ”', 'ì¹œêµ¬/ê°€ì¡± ì¼€ì–´ íŒ¨í‚¤ì§€ ë§Œë“¤ê¸°', 'ê¸°ë¶€ ìº í˜ì¸ í•¨ê»˜ ì°¸ì—¬'],
            playlist: ['ì–´ì¿ ìŠ¤í‹± ìºëŸ´', 'Lo-fi Holiday', 'Jazz Christmas'],
            message: 'ë‹¹ì‹ ì˜ ë”°ëœ»í•¨ì´ ì´ ê³„ì ˆì„ ì±„ì›ë‹ˆë‹¤. ì‘ì€ ë°°ë ¤ê°€ í° ê¸°ì–µì„ ë§Œë“¤ ê±°ì˜ˆìš”.'
        },
        FOODIE: {
            actions: ['ì¿ í‚¤/í•«ì´ˆì½” ë§Œë“¤ê¸°', 'ì•¼ì‹œì¥Â·ë§ˆì¼“ íˆ¬ì–´', 'í™ˆ íŒŒí‹° ë””ì €íŠ¸ ë°” ì„¸íŒ…'],
            playlist: ['Sweet & Cozy', 'Cafe BGM', 'Winter Night Vibes'],
            message: 'ë§›ìˆëŠ” í–‰ë³µì„ ë‚˜ëˆ„ëŠ” ë‹¹ì‹  ë•ë¶„ì— ëª¨ë‘ê°€ ì›ƒê²Œ ë©ë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ë“ ë“ íˆ ì¦ê²¨ìš”!'
        },
        PLAYER: {
            actions: ['ë³´ë“œê²Œì„/íŒŒí‹°ê²Œì„ ë°¤ìƒ˜ì „', 'ìºëŸ´+ëŒ„ìŠ¤ ì±Œë¦°ì§€', 'ë°©êµ¬ì„ ëœì„  íŒŒí‹°'],
            playlist: ['EDM Christmas', 'Upbeat Party Mix', 'Pop Holiday Hits'],
            message: 'ë‹¹ì‹ ì˜ í…ì…˜ì´ íŒŒí‹°ì˜ ì‹¬ì¥! ëª¨ë‘ê°€ í•¨ê»˜ ì¦ê¸¸ ìˆ˜ ìˆê²Œ ë¦¬ë“œí•´ ì£¼ì„¸ìš”.'
        },
        DREAMER: {
            actions: ['ë³„ ë³´ê¸° ì‚°ì±…', 'ë¬´ë“œ ì¡°ëª…ê³¼ ë”°ëœ»í•œ í‹°íƒ€ì„', 'ì‚¬ì§„/ì˜ìƒìœ¼ë¡œ ì¶”ì–µ ê¸°ë¡'],
            playlist: ['Lo-fi Snow', 'Indie Winter', 'Piano & Strings'],
            message: 'ê°ì„±ì„ ì±„ìš°ëŠ” ë‹¹ì‹ ì˜ í˜ì´ìŠ¤ë¥¼ ì¡´ì¤‘í•˜ì„¸ìš”. ì¡°ìš©í•œ ì‹œê°„ë„ ìµœê³ ì˜ ì„ ë¬¼ì…ë‹ˆë‹¤.'
        }
    };
    const extra = extras[data.typeKey] || extras.GIVER;
    const actionsList = document.getElementById('actionsList');
    extra.actions.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        actionsList.appendChild(li);
    });
    const pills = document.getElementById('playlistPills');
    extra.playlist.forEach(p => {
        const span = document.createElement('span');
        span.className = 'pill';
        span.textContent = p;
        pills.appendChild(span);
    });
    document.getElementById('messageText').textContent = extra.message;

    function buildShareText() {
        return `ì†”í¬TI | ${data.title}\\n${data.desc}\\n\\në‚˜ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìœ í˜•ì„ ì•Œì•„ë³´ì„¸ìš”!`;
    }

    async function copyResult() {
        try {
            await navigator.clipboard.writeText(buildShareText());
            alert('ê²°ê³¼ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì— ë¶™ì—¬ë„£ê¸° í•´ë³´ì„¸ìš”!');
        } catch (e) {
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
    }

    function openStory() {
        window.open('https://www.instagram.com/stories/create/', '_blank');
    }

    function createResultCanvas() {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1080;
        canvas.height = 1920;

        const bg = '#0B3D2E';
        ctx.fillStyle = bg;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#142B22';
        ctx.beginPath();
        ctx.roundRect(90, 320, 900, 1100, 30);
        ctx.fill();

        ctx.fillStyle = data.color || '#FFD56B';
        ctx.font = 'bold 72px Pretendard, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ì†”í¬TI ê²°ê³¼', canvas.width / 2, 500);

        ctx.fillStyle = '#FFD56B';
        ctx.font = 'bold 80px Pretendard, sans-serif';
        ctx.fillText(data.title, canvas.width / 2, 640);

        ctx.fillStyle = '#F5F5F5';
        ctx.font = '36px Pretendard, sans-serif';
        wrapText(ctx, data.desc, canvas.width / 2, 760, 760, 52);

        ctx.font = '32px Pretendard, sans-serif';
        ctx.fillStyle = '#CFE9D8';
        wrapText(ctx, 'ë‚˜ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìœ í˜•ì„ ì•Œì•„ë³´ê³  ìŠ¤í† ë¦¬ì— ê³µìœ í•´ë³´ì„¸ìš”!', canvas.width / 2, 1250, 760, 48);
        ctx.font = '32px Pretendard, sans-serif';
        ctx.fillStyle = '#CFE9D8';
        wrapText(ctx, 'ì¶”ì²¨ì„ í†µí•´ ìƒí’ˆì„ ì¦ì •í•´ë“œë¦½ë‹ˆë‹¤!', canvas.width / 2, 1350, 760, 48);
        ctx.font = 'bold 34px Pretendard, sans-serif';
        ctx.fillStyle = '#E2AC26';
        ctx.textAlign = 'center';
        ctx.fillText(
            'ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´ ë¸Œë¼ìš°ì €ì— SCTI.kro.krì„ ì…ë ¥í•´ë³´ì„¸ìš”!',
            canvas.width / 2,
            1500
        );
        return canvas;
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        const lines = [];
        words.forEach(word => {
            const test = line + word + ' ';
            if (ctx.measureText(test).width > maxWidth && line !== '') {
                lines.push(line);
                line = word + ' ';
            } else {
                line = test;
            }
        });
        lines.push(line);
        lines.forEach((l, i) => ctx.fillText(l.trim(), x, y + i * lineHeight));
    }

    function downloadCard() {
        const canvas = createResultCanvas();
        const link = document.createElement('a');
        link.download = 'solkti-result.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    }

    async function shareStoryImage() {
        const canvas = createResultCanvas();
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));

        if (!blob) {
            downloadCard();
            openStory();
            return;
        }

        const file = new File([blob], 'solkti-result.png', { type: 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
                await navigator.share({
                    files: [file],
                    title: 'ì†”í¬TI ê²°ê³¼',
                    text: buildShareText(),
                    url: window.location.href   // â† ì¶”ê°€ëœ ìœ ì¼í•œ ì½”ë“œ
                });
                return;
            } catch (e) {}
        }

        const link = document.createElement('a');
        link.download = 'solkti-result.png';
        link.href = URL.createObjectURL(blob);
        link.click();
        openStory();
        alert('ë§Œì•½ ìë™ ì—…ë¡œë“œê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•œ ë’¤ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì—ì„œ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.');
    }

    document.getElementById('copyBtn').addEventListener('click', copyResult);
    document.getElementById('storyBtn').addEventListener('click', shareStoryImage);
    document.getElementById('downloadBtn').addEventListener('click', downloadCard);
    document.getElementById('retryBtn').addEventListener('click', () => {
        window.location.href = 'search.html';
    });

    CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        const radius = Math.min(r, w / 2, h / 2);
        this.beginPath();
        this.moveTo(x + radius, y);
        this.lineTo(x + w - radius, y);
        this.quadraticCurveTo(x + w, y, x + w, y + radius);
        this.lineTo(x + w, y + h - radius);
        this.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
        this.lineTo(x + radius, y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - radius);
        this.lineTo(x, y + radius);
        this.quadraticCurveTo(x, y, x + radius, y);
        this.closePath();
    };

    // ëˆˆ íš¨ê³¼
    (function snow() {
        const snowCount = 80;
        const snowflakes = [];
        for (let i = 0; i < snowCount; i++) {
            const snow = document.createElement('div');
            snow.className = 'snowflake';
            const size = Math.random() * 4 + 2;
            snow.style.width = size + 'px';
            snow.style.height = size + 'px';
            snow.style.left = Math.random() * window.innerWidth + 'px';
            snow.style.top = Math.random() * window.innerHeight + 'px';
            snow.speed = Math.random() * 1 + 0.5;
            document.body.appendChild(snow);
            snowflakes.push(snow);
        }
        function animateSnow() {
            snowflakes.forEach(snow => {
                let top = parseFloat(snow.style.top);
                top += snow.speed;
                if (top >= window.innerHeight - 1) {
                    top = -10;
                    snow.style.left = Math.random() * window.innerWidth + 'px';
                }
                snow.style.top = top + 'px';
            });
            requestAnimationFrame(animateSnow);
        }
        animateSnow();
    })();
    </script>
</body>
</html>

