<!--Made By Goyounghee 2025. 12. 14.-->
<!--ì´ê±° ê±´ë“¤ì—¬ì„œ ê³ ì¥ë‚˜ë©´ ì•Œì•„ì„œ ì²˜ë¦¬í•˜ì…”ì•¼í•¨.-->
<!--2025 í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì´ë²¤íŠ¸ for ì„ì ì¤‘í•™êµ-->
<!--+ ì´ê±° Js ë¶€ë¶„ì€ Cursorë¡œ ë§Œë“¤ì—ˆìœ¼ë‹ˆê¹Œ ë­.. ì˜ë ê²ë‹ˆë‹¤.. ã…ã…‡ã…Œ-->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ã…£ì†”í¬TI</title>
    <link rel="stylesheet" href="search.css">
</head>
<body>
    <div class="guide-topbar" id="progressBar">
        <div class="top-bar active">1ë²ˆ</div>
        <div class="top-bar">2ë²ˆ</div>
        <div class="top-bar">3ë²ˆ</div>
        <div class="top-bar">4ë²ˆ</div>
        <div class="top-bar">5ë²ˆ</div>
    </div>
    
    <div class="question">
        <div class="question-glow"></div>
        <div id="questionTitle" class="question-text">í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì—<br>í•˜ê³ ì‹¶ì€ í–‰ë™ì€?</div>
    </div>

    <div class="selection-btn" id="selectionContainer">
        <!-- JSê°€ ì§ˆë¬¸ë³„ ë³´ê¸° ë²„íŠ¼ì„ ë Œë”ë§í•©ë‹ˆë‹¤ -->
    </div>

    <div id="resultCard" class="result-card hidden">
        <div class="result-badge" id="resultBadge">ì†”í¬TI</div>
        <div class="result-title" id="resultTitle">ê²°ê³¼ íƒ€ì´í‹€</div>
        <div class="result-desc" id="resultDesc">ì„¤ëª…</div>
        <div class="result-actions">
            <button class="share-btn primary" id="retryBtn">ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸°</button>
            <button class="share-btn" id="copyBtn">ê²°ê³¼ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
            <button class="share-btn" id="storyBtn">ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ë¡œ ê³µìœ </button>
        </div>
        <div class="result-tip">TIP: ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•œ ë’¤ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì— ì˜¬ë¦¬ì„¸ìš”.</div>
        <button class="share-btn outline" id="downloadCardBtn">ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</body>
<script>
// --------------------------- í€´ì¦ˆ ë°ì´í„° (ì—¬ê¸°ë§Œ ìˆ˜ì •í•˜ë©´ ì§ˆë¬¸/ë³´ê¸°/ìœ í˜• ë³€ê²½ ê°€ëŠ¥) ---------------------------
const quizData = {
    questions: [
        {
            text: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì— í•˜ê³  ì‹¶ì€ í–‰ë™ì€?',
            options: [
                { label: 'ì„ ë¬¼ ì£¼ê¸°', type: 'GIVER' },
                { label: 'ê°„ì‹ ë¨¹ê¸°', type: 'FOODIE' },
                { label: 'ê²Œì„í•˜ê¸°', type: 'PLAYER' }
            ]
        },
        {
            text: 'í•¨ê»˜ ë³´ë‚´ê³  ì‹¶ì€ ì‚¬ëŒì€?',
            options: [
                { label: 'ê°€ì¡±', type: 'GIVER' },
                { label: 'ì¹œêµ¬', type: 'PLAYER' },
                { label: 'ì—°ì¸/ì¸', type: 'DREAMER' }
            ]
        },
        {
            text: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìŒì•… ì·¨í–¥ì€?',
            options: [
                { label: 'ìºëŸ´ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸', type: 'GIVER' },
                { label: 'Lo-fi ì”ì”í…œ', type: 'DREAMER' },
                { label: 'ì‹ ë‚˜ëŠ” EDM', type: 'PLAYER' }
            ]
        },
        {
            text: 'ì˜¬í•´ ê°€ì¥ í•´ë³´ê³  ì‹¶ì€ ê²ƒì€?',
            options: [
                { label: 'ì§ì ‘ ë§Œë“  ì„ ë¬¼ ë‚˜ëˆ”', type: 'GIVER' },
                { label: 'ë§›ì§‘ íˆ¬ì–´', type: 'FOODIE' },
                { label: 'ë°©êµ¬ì„ íŒŒí‹°/ê²Œì„', type: 'PLAYER' }
            ]
        },
        {
            text: 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì˜ ë‚˜ë¥¼ í•œ ë‹¨ì–´ë¡œ?',
            options: [
                { label: 'ë”°ëœ»í•œ ì‚°íƒ€', type: 'GIVER' },
                { label: 'ë¨¹ë°© ìš”ì •', type: 'FOODIE' },
                { label: 'ë£¨ëŒí”„ ë“œë¦¬ë¨¸', type: 'DREAMER' }
            ]
        }
    ],
    types: {
        GIVER: {
            title: 'ì‚°íƒ€í˜• GIVER',
            desc: 'ì„ ë¬¼ë¶€í„° ê°„ì‹ê¹Œì§€ ë¯¸ë¦¬ ì±™ê²¨ë‘ëŠ” ì¤€ë¹„ì„± ë§Œë ™ ê³„íšëŸ¬ì˜ˆìš”. ë‹¹ì‹ ì´ ì›€ì§ì´ë©´ ë¶„ìœ„ê¸°ê°€ ê¸ˆë°© ë”°ëœ»í•´ì§€ê³ , ëª¨ë‘ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ì°¸ì—¬í•˜ê²Œ ë¼ìš”.',
            color: '#E2AC26'
        },
        FOODIE: {
            title: 'ë¨¹ë°©ìš”ì • FOODIE',
            desc: 'ì‹ ìƒ ê°„ì‹ê³¼ ë””ì €íŠ¸ì— ëˆˆì´ ë°˜ì§ì´ëŠ” í–‰ë³µ ì „ë„ì‚¬ì˜ˆìš”. ë§›ìˆëŠ” ê±´ ë‚˜ëˆ ì•¼ ì œë§›ì´ë¼ë©° ì£¼ë³€ ì‚¬ëŒë„ ì±™ê¸°ê³ , í–¥ê³¼ ë¶„ìœ„ê¸°ê¹Œì§€ ì„¬ì„¸í•˜ê²Œ ì‚´í´ë´ìš”.',
            color: '#F27575'
        },
        PLAYER: {
            title: 'íŒŒí‹°ëŸ¬ PLAYER',
            desc: 'ì‹ ìƒ ê²Œì„Â·í€´ì¦ˆÂ·ëŒ„ìŠ¤ë§Œ ë‚˜ì˜¤ë©´ ëˆˆì´ ë°˜ì§ì´ëŠ” ë¶„ìœ„ê¸° ë©”ì´ì»¤ì˜ˆìš”. í˜„ì¥ ì—ë„ˆì§€ê°€ ë–¨ì–´ì§ˆ í‹ˆ ì—†ì´ ë°”ë¡œ ë†€ê±°ë¦¬ë‚˜ ë¯¸ì…˜ì„ ëšë”± ë§Œë“¤ì–´ë‚´ê³ , í˜¼ìë³´ë‹¤ â€œë‹¤ ê°™ì´â€ ì¦ê¸°ëŠ” ê±¸ ì œì¼ ì¢‹ì•„í•´ìš”. ëˆ„êµ¬ í•˜ë‚˜ ë¹ ì§€ì§€ ì•Šê²Œ ì±™ê¸°ë©° íŒ€ ì „ì²´ë¥¼ ëŒì–´ì˜¬ë¦¬ëŠ” íƒ€ì…ì´ì—ìš”.',
            color: '#6BD9A8'
        },
        DREAMER: {
            title: 'ë“œë¦¬ë¨¸ DREAMER',
            desc: 'ì¡°ëª…, ìŒì•…, í–¥ê¹Œì§€ ì„¸ì‹¬í•˜ê²Œ ì‚´í”¼ë©° ë¶„ìœ„ê¸°ë¥¼ ë¹šì–´ë‚´ëŠ” ë¬´ë“œ ì¥ì¸ì´ì—ìš”.\nì‚¬ì§„ê³¼ ì˜ìƒ, ê¸€ë¡œ ìˆœê°„ì„ ê¸°ë¡í•´ ì¶”ì–µì„ ì°¨ê³¡ì°¨ê³¡ ìŒ“ì•„ë‘ê³ ,\nì¡°ìš©í•œ ì‚°ì±…ì´ë‚˜ ë³„ ë³´ê¸°, ì”ì”í•œ ëŒ€í™”ì²˜ëŸ¼ ëŠë¦° ì‹œê°„ì„ íŠ¹íˆ ì•„ê»´ìš”.',
            color: '#8AB2FF'
        }
    }
};

// --------------------------- ìƒíƒœ ë° DOM ---------------------------
let currentStep = 0;
const scores = {};
const questionTitleEl = document.getElementById('questionTitle');
const selectionContainerEl = document.getElementById('selectionContainer');
const progressBarEls = document.querySelectorAll('#progressBar .top-bar');

const resultCardEl = document.getElementById('resultCard');
const resultBadgeEl = document.getElementById('resultBadge');
const resultTitleEl = document.getElementById('resultTitle');
const resultDescEl = document.getElementById('resultDesc');
const retryBtn = document.getElementById('retryBtn');
const copyBtn = document.getElementById('copyBtn');
const storyBtn = document.getElementById('storyBtn');
const downloadCardBtn = document.getElementById('downloadCardBtn');

// --------------------------- ë Œë”ë§ ---------------------------
function renderQuestion() {
    const question = quizData.questions[currentStep];
    questionTitleEl.innerHTML = question.text.replace(/\n/g, '<br>');
    selectionContainerEl.innerHTML = '';

    question.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'selection';
        btn.type = 'button';
        btn.innerHTML = `<span class="selection-text">${idx + 1}. ${opt.label}</span>`;
        btn.addEventListener('click', () => handleSelect(opt.type));
        selectionContainerEl.appendChild(btn);
    });

    updateProgress();
    toggleViews('quiz');
}

function updateProgress() {
    progressBarEls.forEach((el, idx) => {
        el.classList.remove('active', 'done');
        if (idx < currentStep) el.classList.add('done');
        if (idx === currentStep) el.classList.add('active');
    });
}

function toggleViews(view) {
    const isResult = view === 'result';
    resultCardEl.classList.toggle('hidden', !isResult);
    selectionContainerEl.classList.toggle('hidden', isResult);
    questionTitleEl.classList.toggle('hidden', isResult);
    document.querySelector('.question-glow').classList.toggle('hidden', isResult);
}

// --------------------------- ë¡œì§ ---------------------------
function handleSelect(type) {
    scores[type] = (scores[type] || 0) + 1;
    const isLast = currentStep === quizData.questions.length - 1;
    if (isLast) {
        showResult();
        return;
    }
    currentStep += 1;
    renderQuestion();
}

function getResultType() {
    let best = null;
    Object.entries(scores).forEach(([key, val]) => {
        if (!best || val > best.score) best = { key, score: val };
    });
    // ëª¨ë“  ë¬¸í•­ì´ ë‹¤ë¥¸ íƒ€ì…ì´ë¼ë©´ ì²« ë²ˆì§¸ ì˜µì…˜ íƒ€ì…ì„ ê¸°ë³¸ìœ¼ë¡œ
    return best ? best.key : quizData.questions[0].options[0].type;
}

function showResult() {
    const typeKey = getResultType();
    const typeData = quizData.types[typeKey] || quizData.types[quizData.questions[0].options[0].type];

    // ê²°ê³¼ ë°ì´í„° ì €ì¥ í›„ ë³„ë„ í˜ì´ì§€ë¡œ ì´ë™
    sessionStorage.setItem('solktiResult', JSON.stringify({
        typeKey,
        title: typeData.title,
        desc: typeData.desc,
        color: typeData.color || '#FFD56B'
    }));
    window.location.href = 'result.html';
}

function resetQuiz() {
    currentStep = 0;
    Object.keys(scores).forEach(k => delete scores[k]);
    renderQuestion();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --------------------------- ê³µìœ /ë‹¤ìš´ë¡œë“œ ---------------------------
function buildShareText() {
    const typeKey = getResultType();
    const typeData = quizData.types[typeKey];
    return `ì†”í¬TI | ${typeData.title}\n${typeData.desc}\n\në‚˜ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìœ í˜•ì„ ì•Œì•„ë³´ì„¸ìš”!`;
}

async function copyResult() {
    try {
        await navigator.clipboard.writeText(buildShareText());
        alert('ê²°ê³¼ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì— ë¶™ì—¬ë„£ê¸° í•´ë³´ì„¸ìš”!');
    } catch (e) {
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    }
}

function openStory() {
    // ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ í¸ì§‘ì°½ (ëª¨ë°”ì¼/ë¡œê·¸ì¸ í™˜ê²½ì—ì„œ ë™ì‘). ë°±ì—…ìš©ìœ¼ë¡œ ìƒˆ íƒ­ì„ ì—½ë‹ˆë‹¤.
    window.open('https://www.instagram.com/stories/create/', '_blank');
}

function createResultCanvas() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 1080;
    canvas.height = 1920;

    const typeKey = getResultType();
    const typeData = quizData.types[typeKey];
    const bg = '#0B3D2E';

    // ë°°ê²½
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ì¹´ë“œ
    ctx.fillStyle = '#142B22';
    ctx.roundRect(90, 320, 900, 1100, 30);
    ctx.fill();

    // ì œëª©
    ctx.fillStyle = typeData.color || '#FFD56B';
    ctx.font = 'bold 72px Pretendard, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('ì†”í¬TI ê²°ê³¼', canvas.width / 2, 500);

    // íƒ€ì…
    ctx.fillStyle = '#FFD56B';
    ctx.font = 'bold 80px Pretendard, sans-serif';
    ctx.fillText(typeData.title, canvas.width / 2, 640);

    // ì„¤ëª…
    ctx.fillStyle = '#F5F5F5';
    ctx.font = '36px Pretendard, sans-serif';
    wrapText(ctx, typeData.desc, canvas.width / 2, 760, 760, 52);

    // í•˜ë‹¨ ë¬¸êµ¬
    ctx.font = '32px Pretendard, sans-serif';
    ctx.fillStyle = '#CFE9D8';
    wrapText(ctx, 'ë‚˜ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ìœ í˜•ì„ ì•Œì•„ë³´ê³  ìŠ¤í† ë¦¬ì— ê³µìœ í•´ë³´ì„¸ìš”!', canvas.width / 2, 1250, 760, 48);

    return canvas;
}

function downloadCard() {
    const canvas = createResultCanvas();
    const link = document.createElement('a');
    link.download = 'solkti-result.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
}

async function shareStoryImage() {
    const canvas = createResultCanvas();
    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    if (!blob) {
        downloadCard();
        openStory();
        return;
    }

    const file = new File([blob], 'solkti-result.png', { type: 'image/png' });

    // Web Share Level 2 ì§€ì› ì‹œ ë°”ë¡œ ê³µìœ  ì‹œë„ (ëª¨ë°”ì¼ í¬ë¡¬/ì‚¬íŒŒë¦¬ ì¼ë¶€)
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
            await navigator.share({
                files: [file],
                title: 'ì†”í¬TI ê²°ê³¼',
                text: buildShareText()
            });
            return;
        } catch (e) {
            // ìœ ì € ì·¨ì†Œ ë“±ì€ ë¬´ì‹œí•˜ê³  í´ë°±
        }
    }

    // í´ë°±: ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í›„ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ í¸ì§‘ì°½ ì—´ê¸°
    const link = document.createElement('a');
    link.download = 'solkti-result.png';
    link.href = URL.createObjectURL(blob);
    link.click();
    openStory();
    alert('ì´ë¯¸ì§€ë¥¼ ì €ì¥í•œ ë’¤ ì¸ìŠ¤íƒ€ ìŠ¤í† ë¦¬ì—ì„œ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.');
}

function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
    const words = text.split(' ');
    let line = '';
    const lines = [];
    words.forEach(word => {
        const test = line + word + ' ';
        if (ctx.measureText(test).width > maxWidth && line !== '') {
            lines.push(line);
            line = word + ' ';
        } else {
            line = test;
        }
    });
    lines.push(line);
    lines.forEach((l, i) => ctx.fillText(l.trim(), x, y + i * lineHeight));
}

// --------------------------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---------------------------
retryBtn.addEventListener('click', resetQuiz);
copyBtn.addEventListener('click', copyResult);
storyBtn.addEventListener('click', shareStoryImage);
downloadCardBtn.addEventListener('click', downloadCard);

// ìº”ë²„ìŠ¤ì—ì„œ ë‘¥ê·¼ ì‚¬ê°í˜•ì„ ìœ„í•œ helper
CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
    const radius = Math.min(r, w / 2, h / 2);
    this.beginPath();
    this.moveTo(x + radius, y);
    this.lineTo(x + w - radius, y);
    this.quadraticCurveTo(x + w, y, x + w, y + radius);
    this.lineTo(x + w, y + h - radius);
    this.quadraticCurveTo(x + w, y + h, x + w - radius, y + h);
    this.lineTo(x + radius, y + h);
    this.quadraticCurveTo(x, y + h, x, y + h - radius);
    this.lineTo(x, y + radius);
    this.quadraticCurveTo(x, y, x + radius, y);
    this.closePath();
};

// ì´ˆê¸° ë Œë”
renderQuestion();
</script>
<script>
const snowCount = 100;
const snowflakes = [];

for (let i = 0; i < snowCount; i++) {
    const snow = document.createElement('div');
    snow.className = 'snowflake';

    const size = Math.random() * 4 + 2;
    snow.style.width = size + 'px';
    snow.style.height = size + 'px';
    snow.style.left = Math.random() * window.innerWidth + 'px';
    snow.style.top = Math.random() * window.innerHeight + 'px';
    snow.speed = Math.random() * 1 + 0.5; // ëˆˆì†¡ì´ ì†ë„

    // ëˆˆì†¡ì´ê°€ ìŠ¤í¬ë¡¤ ì˜í–¥ì„ ì•ˆ ë°›ê²Œ positionì„ fixedë¡œ ë³€ê²½
    snow.style.position = 'fixed';

    document.body.appendChild(snow);
    snowflakes.push(snow);
}

function animateSnow() {
    snowflakes.forEach(snow => {
        let top = parseFloat(snow.style.top);
        top += snow.speed;

        if (top >= window.innerHeight - 1) {
            top = -10; // í™”ë©´ ìœ„ë¡œ ë‹¤ì‹œ ë³´ëƒ„
            snow.style.left = Math.random() * window.innerWidth + 'px';
        }

        snow.style.top = top + 'px';
    });
    requestAnimationFrame(animateSnow);
}

animateSnow();
</script>
</html>